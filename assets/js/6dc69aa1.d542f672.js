/*! For license information please see 6dc69aa1.d542f672.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[775302],{533914:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var i=n(474848),t=n(28453);const s={id:"processors",title:"Processors",description:"How to setup notification processors"},a=void 0,r={id:"notifications/processors",title:"Processors",description:"How to setup notification processors",source:"@site/versioned_docs/version-stable/notifications/processors.md",sourceDirName:"notifications",slug:"/notifications/processors",permalink:"/docs/notifications/processors",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/notifications/processors.md",tags:[],version:"stable",frontMatter:{id:"processors",title:"Processors",description:"How to setup notification processors"},sidebar:"docs",previous:{title:"Getting Started",permalink:"/docs/notifications/"},next:{title:"Usage",permalink:"/docs/notifications/usage"}},c={},l=[{value:"Built-in Processors",id:"built-in-processors",level:2},{value:"Email Processor",id:"email-processor",level:3}];function d(e){const o={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.p,{children:["Notifications can be extended with ",(0,i.jsx)(o.code,{children:"NotificationProcessor"}),". These processors allow you to decorate notifications before they are sent and/or send the notifications to external services."]}),"\n",(0,i.jsx)(o.p,{children:"Depending on your needs, a processor can modify the content of a notification or route it to different systems like email, Slack, or other services."}),"\n",(0,i.jsxs)(o.p,{children:["A good example of how to write a processor is the ",(0,i.jsx)(o.a,{href:"https://github.com/backstage/backstage/tree/master/plugins/notifications-backend-module-email",children:"Email Processor"}),"."]}),"\n",(0,i.jsx)(o.p,{children:"Start off by creating a notification processor:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-ts",children:"import { Notification } from '@backstage/plugin-notifications-common';\nimport { NotificationProcessor } from '@backstage/plugin-notifications-node';\n\nclass MyNotificationProcessor implements NotificationProcessor {\n  // preProcess is called before the notification is saved to database.\n  // This is a good place to modify the notification before it is saved and sent to the user.\n  async preProcess(notification: Notification): Promise<Notification> {\n    if (notification.origin === 'plugin-my-plugin') {\n      notification.payload.icon = 'my-icon';\n    }\n    return notification;\n  }\n\n  // postProcess is called after the notification is saved to database and the signal is emitted.\n  // This is a good place to send the notification to external services.\n  async postProcess(notification: Notification): Promise<void> {\n    nodemailer.sendEmail({\n      from: 'backstage',\n      to: 'user',\n      subject: notification.payload.title,\n      text: notification.payload.description,\n    });\n  }\n}\n"})}),"\n",(0,i.jsx)(o.p,{children:"Both of the processing functions are optional, and you can just implement one of them."}),"\n",(0,i.jsx)(o.p,{children:"Add the notification processor to the notification system by:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-ts",children:"import { notificationsProcessingExtensionPoint } from '@backstage/plugin-notifications-node';\nimport { Notification } from '@backstage/plugin-notifications-common';\n\nexport const myPlugin = createBackendPlugin({\n  pluginId: 'myPlugin',\n  register(env) {\n    env.registerInit({\n      deps: {\n        notifications: notificationsProcessingExtensionPoint,\n        // ...\n      },\n      async init({ notifications }) {\n        // ...\n        notifications.addProcessor(new MyNotificationProcessor());\n      },\n    });\n  },\n});\n"})}),"\n",(0,i.jsx)(o.h2,{id:"built-in-processors",children:"Built-in Processors"}),"\n",(0,i.jsx)(o.p,{children:"Backstage comes with some processors that can be used immediately."}),"\n",(0,i.jsx)(o.h3,{id:"email-processor",children:"Email Processor"}),"\n",(0,i.jsxs)(o.p,{children:["Email processor is used to send notifications to users using email. To install the email processor, add the ",(0,i.jsx)(o.code,{children:"@backstage/plugin-notifications-backend-module-email"})," package to your backend."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"yarn workspace backend add @backstage/plugin-notifications-backend-module-email\n"})}),"\n",(0,i.jsx)(o.p,{children:"Add the email processor to your backend:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-ts",children:"import { createBackend } from '@backstage/plugin-notifications-backend';\nconst backend = createBackend();\n// ...\nbackend.add(import('@backstage/plugin-notifications-backend-module-email'));\n"})}),"\n",(0,i.jsxs)(o.p,{children:["To configure the email processor, you need to add the following configuration to your ",(0,i.jsx)(o.code,{children:"app-config.yaml"}),":"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:"notifications:\n  email:\n    smtp:\n      host: smtp.example.com\n      port: 587\n      secure: false\n      username: ${SMTP_USERNAME}\n      password: ${SMTP_PASSWORD}\n"})}),"\n",(0,i.jsx)(o.p,{children:"Apart from STMP, the email processor also supports the following transmissions:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"SES"}),"\n",(0,i.jsx)(o.li,{children:"sendmail"}),"\n",(0,i.jsx)(o.li,{children:"stream (only for debugging purposes)"}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["See more information at ",(0,i.jsx)(o.a,{href:"https://github.com/backstage/backstage/blob/master/plugins/notifications-backend-module-email/README.md",children:"https://github.com/backstage/backstage/blob/master/plugins/notifications-backend-module-email/README.md"})]})]})}function p(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},221020:(e,o,n)=>{var i=n(296540),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,o,n){var i,s={},l=null,d=null;for(i in void 0!==n&&(l=""+n),void 0!==o.key&&(l=""+o.key),void 0!==o.ref&&(d=o.ref),o)a.call(o,i)&&!c.hasOwnProperty(i)&&(s[i]=o[i]);if(e&&e.defaultProps)for(i in o=e.defaultProps)void 0===s[i]&&(s[i]=o[i]);return{$$typeof:t,type:e,key:l,ref:d,props:s,_owner:r.current}}o.Fragment=s,o.jsx=l,o.jsxs=l},474848:(e,o,n)=>{e.exports=n(221020)},28453:(e,o,n)=>{n.d(o,{R:()=>a,x:()=>r});var i=n(296540);const t={},s=i.createContext(t);function a(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);