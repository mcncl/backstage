/*! For license information please see e3218a9a.3544db29.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[891407],{9156:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var i=t(474848),r=t(28453);const s={id:"auditor",title:"Auditor Service",sidebar_label:"Auditor",description:"Documentation for the Auditor service"},o=void 0,c={id:"backend-system/core-services/auditor",title:"Auditor Service",description:"Documentation for the Auditor service",source:"@site/versioned_docs/version-stable/backend-system/core-services/auditor.md",sourceDirName:"backend-system/core-services",slug:"/backend-system/core-services/auditor",permalink:"/docs/backend-system/core-services/auditor",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/backend-system/core-services/auditor.md",tags:[],version:"stable",frontMatter:{id:"auditor",title:"Auditor Service",sidebar_label:"Auditor",description:"Documentation for the Auditor service"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/backend-system/core-services/index"},next:{title:"Auth",permalink:"/docs/backend-system/core-services/auth"}},a={},d=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"How it Works",id:"how-it-works",level:2},{value:"Usage Guidance",id:"usage-guidance",level:2},{value:"Using the Service",id:"using-the-service",level:2},{value:"Naming Conventions",id:"naming-conventions",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["This document describes the Auditor Service, a software service designed to record and report on security-relevant events within an application. This service utilizes the ",(0,i.jsx)(n.code,{children:"winston"})," library for logging and provides a flexible way to capture and format audit events."]}),"\n",(0,i.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Provides a standardized way to capture security events."}),"\n",(0,i.jsx)(n.li,{children:"Allows categorization of events by severity level."}),"\n",(0,i.jsx)(n.li,{children:"Supports detailed metadata for each event."}),"\n",(0,i.jsx)(n.li,{children:"Offers success/failure reporting for events."}),"\n",(0,i.jsx)(n.li,{children:"Integrates with authentication and plugin services for enhanced context."}),"\n",(0,i.jsxs)(n.li,{children:["Uses ",(0,i.jsx)(n.code,{children:"winston"})," for flexible log formatting and transport."]}),"\n",(0,i.jsx)(n.li,{children:"Provides a service factory for easy integration with Backstage plugins."}),"\n",(0,i.jsx)(n.li,{children:"Supports configurable log transports (console, file)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-it-works",children:"How it Works"}),"\n",(0,i.jsxs)(n.p,{children:["The Auditor Service defines a core class, ",(0,i.jsx)(n.code,{children:"Auditor"}),", which implements the ",(0,i.jsx)(n.code,{children:"AuditorService"})," interface. This class uses ",(0,i.jsx)(n.code,{children:"winston"})," to log audit events with varying levels of severity and associated metadata. It also integrates with authentication and plugin services to capture actor details and plugin context."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"auditorServiceFactory"})," creates an ",(0,i.jsx)(n.code,{children:"Auditor"})," instance for the root context and provides a factory function for creating child loggers for individual plugins. This allows each plugin to have its own logger with inherited and additional metadata."]}),"\n",(0,i.jsx)(n.h2,{id:"usage-guidance",children:"Usage Guidance"}),"\n",(0,i.jsx)(n.p,{children:"The Auditor Service is designed for recording security-relevant events that require special attention or are subject to compliance regulations. These events often involve actions like:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"User session management"}),"\n",(0,i.jsx)(n.li,{children:"Data access and modification"}),"\n",(0,i.jsx)(n.li,{children:"System configuration changes"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For general application logging that is not security-critical, you should use the standard ",(0,i.jsx)(n.code,{children:"LoggerService"})," provided by Backstage. This helps to keep your audit logs focused and relevant."]}),"\n",(0,i.jsx)(n.h2,{id:"using-the-service",children:"Using the Service"}),"\n",(0,i.jsx)(n.p,{children:"The Auditor Service can be accessed via dependency injection in your Backstage plugin. Here's an example of how to access the service and create an audit event within an Express route handler:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export async function createRouter(\n  options: RouterOptions,\n): Promise<express.Router> {\n  const { auditor } = options;\n\n  const router = Router();\n  router.use(express.json());\n\n  router.post('/my-endpoint', async (req, res) => {\n    const auditorEvent = await auditor.createEvent({\n      eventId: 'my-endpoint-call',\n      request: req,\n      meta: {\n        // ... metadata about the request\n      },\n    });\n\n    try {\n      // ... process the request\n\n      await auditorEvent.success();\n      res.status(200).json({ message: 'Succeeded!' });\n    } catch (error) {\n      await auditorEvent.fail({ error });\n      res.status(500).json({ message: 'Failed!' });\n      throw error;\n    }\n  });\n\n  return router;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, an audit event is created for each request to ",(0,i.jsx)(n.code,{children:"/my-endpoint"}),". The ",(0,i.jsx)(n.code,{children:"success"})," or ",(0,i.jsx)(n.code,{children:"fail"})," methods are called based on the outcome of processing the request."]}),"\n",(0,i.jsx)(n.h2,{id:"naming-conventions",children:"Naming Conventions"}),"\n",(0,i.jsxs)(n.p,{children:["When defining ",(0,i.jsx)(n.code,{children:"eventId"})," and ",(0,i.jsx)(n.code,{children:"subEventId"})," for your audit events, follow these guidelines:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use kebab-case (e.g., ",(0,i.jsx)(n.code,{children:"user-login"}),", ",(0,i.jsx)(n.code,{children:"file-download"}),", ",(0,i.jsx)(n.code,{children:"fetch"}),", ",(0,i.jsx)(n.code,{children:"entity-create"}),", ",(0,i.jsx)(n.code,{children:"entity-update"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"eventId"}),' represents a logical group of similar events or operations. For example, "fetch" could be used as an ',(0,i.jsx)(n.code,{children:"eventId"})," encompassing various fetch methods like ",(0,i.jsx)(n.code,{children:"by-id"})," or ",(0,i.jsx)(n.code,{children:"by-location"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"subEventId"})," to further categorize events within a logical group. For example, if the ",(0,i.jsx)(n.code,{children:"eventId"}),' is "fetch", the ',(0,i.jsx)(n.code,{children:"subEventId"}),' could be "by-id" or "by-location" to specify the method used for fetching.']}),"\n",(0,i.jsx)(n.li,{children:"Avoid redundant prefixes related to the plugin ID, as that context is already provided."}),"\n",(0,i.jsx)(n.li,{children:"Choose names that clearly and concisely describe the event being audited."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},221020:(e,n,t)=>{var i=t(296540),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,t){var i,s={},d=null,l=null;for(i in void 0!==t&&(d=""+t),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(l=n.ref),n)o.call(n,i)&&!a.hasOwnProperty(i)&&(s[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps)void 0===s[i]&&(s[i]=n[i]);return{$$typeof:r,type:e,key:d,ref:l,props:s,_owner:c.current}}n.Fragment=s,n.jsx=d,n.jsxs=d},474848:(e,n,t)=>{e.exports=t(221020)},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var i=t(296540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);