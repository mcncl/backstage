var S=n=>{throw TypeError(n)};var g=(n,t,e)=>t.has(n)||S("Cannot "+e);var c=(n,t,e)=>(g(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>t.has(n)?S("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),R=(n,t,e,a)=>(g(n,t,"write to private field"),a?a.call(n,e):t.set(n,e),e),u=(n,t,e)=>(g(n,t,"access private method"),e);import{N as b,f as l}from"./ApiRef-DQ_p_ST9.js";import{s as v,p as B,D as U}from"./ref-8pKZtiZi.js";import{c as j}from"./api-MB_AVTXQ.js";import{b as C}from"./appWrappers-BjEVlosn.js";const M=Symbol.for("CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111"),F=["attachments","relations","status","metadata.name","metadata.namespace","metadata.uid","metadata.etag"];function T(n){const t=[];function e(a,o){if(!F.includes(a)){if(o==null||["string","number","boolean"].includes(typeof o)){t.push({key:a,value:o});return}if(typeof o=="object"){if(Array.isArray(o)){for(const i of o)if(e(a,i),typeof i=="string"){const s=`${a}.${i}`;t.some(f=>f.key.toLocaleLowerCase("en-US")===s.toLocaleLowerCase("en-US"))||t.push({key:s,value:!0})}return}for(const[i,s]of Object.entries(o))e(a?`${a}.${i}`:i,s)}}}return e("",n),t}function I(n){var e,a,o;const t=T(n);(e=n.metadata)!=null&&e.name&&t.push({key:"metadata.name",value:n.metadata.name.toLocaleLowerCase("en-US")}),(a=n.metadata)!=null&&a.namespace&&t.push({key:"metadata.namespace",value:n.metadata.namespace.toLocaleLowerCase("en-US")}),(o=n.metadata)!=null&&o.uid&&t.push({key:"metadata.uid",value:n.metadata.uid.toLocaleLowerCase("en-US")}),n.metadata.namespace||t.push({key:"metadata.namespace",value:U});for(const i of n.relations??[])t.push({key:`relations.${i.type.toLocaleLowerCase("en-US")}`,value:i.targetRef.toLocaleLowerCase("en-US")});return t}function p(n){if(!n)return()=>!0;const t=[n].flat();return e=>{const a=I(e);return t.some(o=>{for(const[i,s]of Object.entries(o)){const f=a.filter(y=>y.key===i.toLocaleLowerCase("en-US")).map(y=>{var m;return(m=y.value)==null?void 0:m.toString().toLocaleLowerCase("en-US")});if(f.length===0)return!1;if(s!==M&&!(f!=null&&f.includes(String(s).toLocaleLowerCase("en-US"))))return!1}return!0})}}var r,d,E;class A{constructor(t){w(this,d);w(this,r);var e;R(this,r,((e=t==null?void 0:t.entities)==null?void 0:e.slice())??[])}async getEntities(t){const e=p(t==null?void 0:t.filter);return{items:c(this,r).filter(e)}}async getEntitiesByRefs(t){const e=p(t.filter),a=u(this,d,E).call(this);return{items:t.entityRefs.map(o=>a.get(o)).map(o=>o&&e(o)?o:void 0)}}async queryEntities(t){if(t&&"cursor"in t)return{items:[],pageInfo:{},totalItems:0};const e=p(t==null?void 0:t.filter),a=c(this,r).filter(e);return{items:a,pageInfo:{},totalItems:a.length}}async getEntityAncestors(t){const e=u(this,d,E).call(this).get(t.entityRef);if(!e)throw new b(`Entity with ref ${t.entityRef} not found`);return{items:[{entity:e,parentEntityRefs:[]}],rootEntityRef:t.entityRef}}async getEntityByRef(t){return u(this,d,E).call(this).get(v(B(t)))}async removeEntityByUid(t){const e=c(this,r).findIndex(a=>a.metadata.uid===t);e!==-1&&c(this,r).splice(e,1)}async refreshEntity(t){}async getEntityFacets(t){const e=p(t.filter),a=c(this,r).filter(e);return{facets:Object.fromEntries(t.facets.map(i=>{var y;const s=new Map;for(const m of a){const L=(y=I(m).find(_=>_.key===i.toLocaleLowerCase("en-US")))==null?void 0:y.value;L&&s.set(String(L),(s.get(String(L))??0)+1)}const f=Array.from(s.entries()).map(([m,h])=>({value:m,count:h}));return[i,f]}))}}async getLocationById(t){throw new l("Method not implemented.")}async getLocationByRef(t){throw new l("Method not implemented.")}async addLocation(t){throw new l("Method not implemented.")}async removeLocationById(t){throw new l("Method not implemented.")}async getLocationByEntity(t){throw new l("Method not implemented.")}async validateEntity(t,e){throw new l("Method not implemented.")}}r=new WeakMap,d=new WeakSet,E=function(){return new Map(c(this,r).map(t=>[v(t),t]))};function O(n,t){return e=>{const a=t();if(e)for(const[o,i]of Object.entries(e))typeof i=="function"?a[o].mockImplementation(i):a[o]=i;return Object.assign(a,{factory:C({api:n,deps:{},factory:()=>a})})}}function k(n){return new A(n)}(n=>{n.factory=t=>C({api:j,deps:{},factory:()=>new A(t)}),n.mock=O(j,()=>({getEntities:jest.fn(),getEntitiesByRefs:jest.fn(),queryEntities:jest.fn(),getEntityAncestors:jest.fn(),getEntityByRef:jest.fn(),removeEntityByUid:jest.fn(),refreshEntity:jest.fn(),getEntityFacets:jest.fn(),getLocationById:jest.fn(),getLocationByRef:jest.fn(),addLocation:jest.fn(),removeLocationById:jest.fn(),getLocationByEntity:jest.fn(),validateEntity:jest.fn()}))})(k||(k={}));export{k as c};
